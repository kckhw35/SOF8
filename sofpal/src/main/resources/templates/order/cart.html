<script>
function checkedall(){
	$('#checkall').click(function(){
		// 전체 체크박스 클릭
		if($('#checkall').prop('checked')){
			$('.check').prop('checked',true);
		}else{
			$('.check').prop('checked',false);
		}
		
		// 전체 선택 중 하위 체크박스 체크 해제시 전체 체크 해제
		$('.check').click(function(){
			var total_length = $('input:checkbox[class="check"]').length;
			var checked_length = $('input:checkbox[class="check"]:checked').length;
			
			if(total_length != checked_length){
				$('#checkall').prop('checked',false);
			}else{
				$('#checkall').prop('checked',true);
			}
		});
	});
}

function selectedproduct(){
	$('input:checkbox').on('click', function(){
		var checked_cnt = $('input:checkbox[name="c_ids"]:checked').length;
		var sum = 0;
		var price = 0;
		
		$('#checked_cnt').text(checked_cnt);
		
		// 이곳에 선택된 상품들 값 가져오는 것 추가
	});
	
};

// 선택된 상품 주문
function selectedorder(){
	$('#selectd_order').click(function(){
		$('#cart_form').attr({
			'method' : 'post',
			'action' : '[[@{/order/order}]]'
		});
		$('#cart_form').submit();
	});
}

// 전체 상품 주문
function allorder(){
	$('#all_order').click(function(){
		$('.check').prop('checked',true);
		$('#cart_form').attr({
			'method' : 'post',
			'action' : '[[@{/order/order}]]'
		});
		$('#cart_form').submit();
	});
}

// 선택된 상품 장바구니에서 수량 변경
function updatecart(){
	
}

// 선택된 상품 장바구니에서 삭제
function deletecart(){
	$('#delete_cart').click(function(){
		var c_id = Array();
		$('input:checkbox[name="c_ids"]:checked').each(function(){
			c_id.push($(this).val());
		});

		$.ajax({
			url:'/order/deletecart',
			type:'POST',
			data:{c_id,c_id},
			traditional: true
		});
	});
}

window.onload = function(){
	checkedall();
	selectedproduct();
	selectedorder();
	allorder();
	updatecart();
	deletecart();
};
</script>

<section class="page-header">
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<div class="content">
					<h1 class="page-name">장바구니</h1>
					<ol class="breadcrumb">
						<li><a th:href="@{/}">Home</a></li>
						<li class="active">장바구니</li>
					</ol>
				</div>
			</div>
		</div>
	</div>
</section>

<!-- 장바구니에 아이템이 있을시 -->
<div class="page-wrapper">
	<div class="cart shopping">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<div class="block">
						<div class="product-list">
							<form method="post" id="cart_form">
								<table class="table line">
									<thead>
										<tr class="cart-amount">
											<th width="1" class="text-center"><input type="checkbox"
												id="checkall" class="check"><label for="checkall"></label></th>
											<th class="">상품/옵션 정보</th>
											<th class="">수량</th>
											<th class="widthDisplayNone">상품금액</th>
											<th class="widthDisplayNone">할인</th>
											<th class="widthDisplayNone">합계금액</th>
											<th class="widthDisplayNone">배송비</th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="c : ${clist}" class="">
											<td>
												<input type="checkbox" th:id="${c.c_id}" class="check" name="c_ids" th:value="${c.c_id}"><label th:for="${c.c_id}"></label>
											</td>
											<td class="">
												<div class="product-info">
													<img width="80"
														th:src="@{/images/shop/products/}+${c.p_img}" /> <input
														type="hidden" name="p_img" th:value="${c.p_img}">
													<a th:href="@{/product/productdetail(p_id=${c.p_id})}"
														th:value="${c.p_id}" th:text="${c.p_name}"></a>
												</div>
											</td>
											<td class="col-md-2" id="c_cnt">
												<div class="product-quantity-slider">
													<input type="number" th:value="${c.c_cnt}" id="product_quantity" name="product_quantity">
												</div>
											</td>
											<td th:text="${c.price}" id="price"></td>
											<td th:text="${c.discount}"></td>
											<td th:text="${c.c_cnt*c.price}" id="sum_price"></td>
											<input type="hidden" name="sum_price" th:value="${c.c_cnt*c.price}" />
											<td th:text="${c.del_cost}"></td>
											<input type="hidden" name="del_cost" th:value="${c.del_cost}" />
										</tr>
									</tbody>
								</table>
								<div class="price-box col-md-12 col-xs-12 col-sm-12">
									<div class="price-content">
										<div class="price-list">
											<dl>
												<dt>
													총 <strong id="checked_cnt" th:text="${totalcnt}">0</strong> 개의 상품금액
												</dt>
												<dd>
													<p id="sumprice"></p>원
												</dd>
											</dl>
											<span><iconify-icon icon="akar-icons:circle-minus-fill" width="25"></iconify-icon></span>
											<dl>
												<dt>할인</dt>
												<dd>
													<p id="sumdiscount"></p>원
													<input type="hidden" name="totaldiscount"/>
												</dd>
											</dl>
											<span><iconify-icon icon="akar-icons:equal-fill" width="25"></iconify-icon></span>
											<dl>
												<dt>배송비</dt>
												<dd>
													<p id="sumdelcost"></p>원
												</dd>
											</dl>
											<span><iconify-icon icon="akar-icons:equal-fill" width="25"></iconify-icon></span>
											<dl class="price-total">
												<dt>합계</dt>
												<dd>
													<p id="totalprice"></p>원
													<input type="hidden" name="totalprice"/>
												</dd>
											</dl>
										</div>
									</div>
								</div>
								<div class="btn-order-box col-md-12 col-xs-12 col-sm-12">
									<div class="btn-left-box">
										<a href="" class="large btn btn-small btn-solid-border"
											id="delete_cart">선택 상품 삭제</a>
									</div>
									<div class="btn-right-box">
										<button type="submit" class="large btn btn-solid-border" id="selectd_order">
											<b>선택 상품 주문</b>
										</button>
										<button type="submit" class="large btn btn-main " id="all_order">
											<b>전체 상품 주문</b>
										</button>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
