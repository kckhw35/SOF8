<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sof8.mapper.OrderMapper">

	<select id="select" parameterType="int" resultType="Order">
		SELECT * FROM orderTBL WHERE o_id = ${o_id}
	</select>
	<select id="selectall" resultType="Order">
		SELECT * FROM orderTBL
	</select>
	<insert id="insert" parameterType="Order">
		INSERT into orderTBL VALUES (o_id, #{user_id}, ${c_id}, ${totalprice}, ${discount}, #{pay_option}, #{o_status}, NOW(), #{c_date}, #{re_name}, #{re_tel}, #{re_zipcode}, #{re_addr}, #{re_deaddr}, #{re_req}, #{note})
	</insert>
	<!-- 주문 상태 변경 -->
	<update id="update" parameterType="Order">
		UPDATE orderTBL SET WHERE o_status = #{o_status}
	</update>
	<!-- 구매 확정 -->
	<update id="confirmbuying" parameterType="Order">
		UPDATE orderTBL SET WHERE c_date = #{c_date}
	</update>
	<!-- 주문 내역은 주문 취소가 되어도 삭제하지 않음 -->
	<delete id="delete" parameterType="int">
		DELETE orderTBL WEHRE o_id = ${o_id}
	</delete>
	<!-- 주문 번호 확인 -->
	<select id="selectoid" resultType="int">
		SELECT count(o_id) FROM orderTBL
	</select>
	<!-- 상품 아이디 확인 -->
	<select id="selectpid" resultType="int">
		SELECT p_id FROM cart WHERE c_id = ${c_id}
	</select>
	<!-- 상품 구매 개수 확인 -->
	<select id="selectcnt" resultType="int">
		SELECT c_cnt FROM cart WHERE c_id = ${c_id}
	</select>
	<!-- 주문 상품 정보 -->
	<select id="selectorderd" parameterType="int" resultType="Product">
		SELECT d.p_id AS p_id, d.d_cnt AS p_cnt, d.price AS price, p.p_name as p_name, p.p_img AS p_img, p.del_cost AS del_cost, p.discount AS discount FROM detail_order d JOIN product p ON d.p_id = p.p_id WHERE o_id = ${o_id};
	</select>
	<!-- 총 주문 수 구하기 -->
	<select id="selectTotal" parameterType="Map" resultType="int">
		SELECT count(*) 
		FROM ordertbl o 
			JOIN detail_order d ON o.o_id = d.o_id
		    JOIN product p ON d.p_id = p.p_id
		<include refid="common.search"></include>
	</select>
	<!-- 주문 리스트 조회 -->
	<select id="selectList" parameterType="Paging" resultType="Order">
		SELECT o.o_date, o.o_id, p.p_name, p.size, p.color, p.price, d.d_cnt, o.o_status, p.p_id, p.p_img, d.de_id
		FROM ordertbl o 
			JOIN detail_order d ON o.o_id = d.o_id
		    JOIN product p ON d.p_id = p.p_id
		<include refid="common.search"></include>
		ORDER BY o.o_date DESC
		<include refid="common.paging"></include>
	</select>
	<update id="updateStatus" parameterType="int">
		UPDATE ordertbl
		SET o_status = '주문취소'
		WHERE o_id = #{o_id}
	</update>
</mapper>